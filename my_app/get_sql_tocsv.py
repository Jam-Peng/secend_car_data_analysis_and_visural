import pymysql, osimport pandas as pdimport numpy as npfrom dotenv import load_dotenvimport timeload_dotenv()sql_host = os.getenv('SQL_HOST')sql_port = eval(os.getenv('SQL_PORT'))sql_uesr = os.getenv('SQL_USER')sql_pwd = os.getenv('SQL_PWD')# 開啟資料庫def open_db():    global conn, cursor    try:        conn=pymysql.connect(host=sql_host, port=sql_port,\                             user=sql_uesr, password=sql_pwd, db=db_name, charset='utf8mb4')        cursor=conn.cursor()    except Exception as e:        print(e)# 取得資料表中的資料def get_table_data():    datas=[]    try:        open_db()        select_table=f"""SELECT * FROM {table_name}"""        cursor.execute(select_table)        datas=cursor.fetchall()        return datas    except Exception as e:        print(e)    finally:        if conn is not None:            conn.close()            # 取得所有資料表名稱def search_tables():    tables=[]    try:        open_db()        cursor.execute("""SHOW TABLE STATUS""")        tables = np.array(cursor.fetchall())[:,0]        return tables    except Exception as e:        print(e)    finally:        if conn is not None:            conn.close()# 儲存csv文件     def save_csv(path):    columns='年份,縣市,車款,排氣量,售價,里程數,瀏覽率,連結,圖片連結'.split(',')    df=pd.DataFrame(datas, columns=columns)    df.set_index('年份',inplace=True)    df.to_csv(f'{path}/{table_name}.csv', encoding='utf-8-sig')# 建立目錄將資料儲存指定路徑def makeDirs_toSave(path):    try:        if not os.path.exists(path):            os.makedirs(path)            if not os.path.exists(f'{path}/{table_name}.csv'):                print(f'{table_name}.csv - 儲存完畢')                save_csv(path)            else:                print('不儲存')        else:            print(f'目錄已存在 - {table_name}.csv儲存完畢')            save_csv(path)    except Exception as e:        print(e)if __name__=='__main__':    conn, cursor = None, None    db_name = "pre_owned_car"    dir_path = '../data_source'    # table_name=input('請選擇要查詢的品牌：')    table_names = search_tables()    for table_name in table_names:        datas = get_table_data()        makeDirs_toSave(dir_path)        time.sleep(1)    print(f'{len(table_names)}筆資料表都儲存完畢')    